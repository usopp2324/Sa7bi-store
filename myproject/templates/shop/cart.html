{% extends 'base.html' %}

{% block title %}Shopping Cart — Sa7bi{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Header -->
  <header class="mb-12">
    <h1 class="text-4xl sm:text-5xl font-black mb-4">
      Your <span class="gradient-text">Shopping Cart</span>
    </h1>
    <p class="text-gray-400 text-lg">Review your items before checkout</p>
  </header>

  {% if cart_items %}
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Cart Items -->
    <div class="lg:col-span-2">
      <div class="bg-dark-800 rounded-2xl border border-dark-700 overflow-hidden">
        <div class="p-6 border-b border-dark-700">
          <h2 class="text-xl font-bold">{{ item_count }} Item{{ item_count|pluralize }}</h2>
        </div>

        <!-- Items List -->
        <div class="divide-y divide-dark-700">
          {% for item in cart_items %}
          <div class="p-6 hover:bg-dark-700/50 transition">
            <!-- Item Header -->
            <div class="flex gap-4 mb-4">
              <a href="{% url 'shop:shop_list' %}" class="flex-shrink-0">
                {% if item.product.image %}
                  <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-24 h-24 rounded-lg object-cover">
                {% else %}
                  <div class="w-24 h-24 rounded-lg bg-dark-700 flex items-center justify-center">
                    <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                  </div>
                {% endif %}
              </a>

              <div class="flex-grow">
                <h3 class="text-lg font-bold text-white">{{ item.product.name }}</h3>
                <p class="text-sm text-gray-400 mt-1">{{ item.product.description|truncatechars:80 }}</p>

                <!-- Price Info -->
                <div class="mt-3 flex items-center gap-4">
                  <div>
                    <p class="text-xs text-gray-500 uppercase">Price</p>
                    <p class="text-lg font-bold text-primary">€{{ item.product.price }}</p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 uppercase">Quantity</p>
                    <form method="POST" action="{% url 'shop:update_cart' item.product.id %}" class="flex items-center">
                      {% csrf_token %}
                      <input 
                        type="number" 
                        name="quantity" 
                        value="{{ item.quantity }}" 
                        min="0" 
                        max="99"
                        class="w-16 px-2 py-1 bg-dark-700 rounded border border-dark-600 text-center text-white"
                        onchange="this.form.submit()"
                      >
                    </form>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 uppercase">Subtotal</p>
                    <p class="text-lg font-bold">€{{ item.subtotal }}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Remove Button -->
            <div class="flex justify-end">
              <a href="{% url 'shop:remove_from_cart' item.product.id %}" class="text-sm text-red-400 hover:text-red-300 transition flex items-center gap-1">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                Remove
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="lg:col-span-1">
      <div class="bg-dark-800 rounded-2xl border border-dark-700 p-6 sticky top-24">
        <h3 class="text-xl font-bold mb-6">Order Summary</h3>

        <!-- Items -->
        <div class="mb-6 pb-6 border-b border-dark-700">
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-400">Subtotal</span>
            <span class="text-white">€{{ total_price }}</span>
          </div>
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-400">Shipping</span>
            <span class="text-primary font-semibold">FREE</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-400">Tax (0%)</span>
            <span class="text-white">€0.00</span>
          </div>
        </div>

        <!-- Total -->
        <div class="mb-6">
          <div class="flex justify-between items-center mb-4">
            <span class="text-lg font-bold">Total</span>
            <span class="text-3xl font-black gradient-text">€{{ total_price }}</span>
          </div>
        </div>

        <!-- Checkout Button -->
        <a href="{% url 'shop:checkout' %}" class="w-full block text-center btn-buy bg-gradient-to-r from-primary to-secondary text-white font-semibold py-3 rounded-xl hover:shadow-lg transition-all">
          Proceed to Checkout
        </a>

        <!-- Continue Shopping -->
        <a href="{% url 'shop:shop_list' %}" class="w-full block text-center mt-3 px-6 py-3 border border-primary/30 rounded-xl font-semibold hover:bg-dark-700 transition">
          Continue Shopping
        </a>

        <!-- Trust Badges -->
        <div class="mt-8 pt-6 border-t border-dark-700">
          <div class="space-y-3 text-xs">
            <div class="flex items-center gap-2 text-gray-400">
              <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
              </svg>
              Secure checkout
            </div>
            <div class="flex items-center gap-2 text-gray-400">
              <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
              </svg>
              Free shipping
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% else %}
  <!-- Empty Cart -->
  <div class="bg-gradient-to-br from-dark-800 to-dark-900 rounded-2xl p-12 text-center border border-dark-700">
    <div class="mb-6">
      <svg class="w-20 h-20 mx-auto text-gray-600 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
      </svg>
    </div>
    <h2 class="text-3xl font-bold mb-2">Your cart is empty</h2>
    <p class="text-gray-400 mb-8 max-w-md mx-auto">Start shopping to add items to your cart</p>
    <a href="{% url 'shop:shop_list' %}" class="inline-block px-8 py-4 bg-gradient-to-r from-primary to-secondary rounded-xl font-semibold hover:shadow-lg transition-all">
      Browse Products
    </a>
  </div>
  {% endif %}
</div>

<style>
  .gradient-text {
    background: linear-gradient(135deg, #ef4444 0%, #000000 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
</style>

{% endblock %}
