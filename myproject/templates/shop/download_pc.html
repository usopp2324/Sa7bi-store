{% extends 'base.html' %}
{% load tz %}

{% block title %}Download for Windows (PC) — Sa7bi{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-12">
  <div class="bg-gradient-to-r from-primary to-primary-dark rounded-xl p-8 text-white shadow-xl">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
      <div>
        <h1 class="text-3xl md:text-4xl font-bold">Sa7bi Desktop for Windows</h1>
        <p class="mt-2 text-red-100/90 max-w-2xl">Fast, offline-capable desktop client. Download the installer below — choose the architecture that matches your Windows.</p>
      </div>
      <div class="flex items-center space-x-3">
        <a href="{% url 'shop:shop_list' %}" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-md">Back to shop</a>
        <a href="/contact" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-md">Support</a>
      </div>
    </div>
  </div>

  <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-4">
      {% for v in versions_pc %}
        {% if forloop.first %}
          <div class="bg-dark-800 border border-gray-800 rounded-lg p-6 shadow-lg">
            <div class="flex items-start justify-between">
              <div class="flex items-center space-x-4">
                <div class="w-14 h-14 bg-gray-900 rounded-md flex items-center justify-center text-blue-400">
                  <i class="fa-brands fa-windows text-3xl"></i>
                </div>
                <div>
                  <div class="text-2xl font-semibold">{{ v.title }} <span class="text-gray-400 text-sm">v{{ v.version }}</span></div>
                  <div class="text-sm text-gray-500 mt-1">Released {{ v.published_at|date:"F j, Y" }} · {{ v.published_at|timesince }} ago</div>
                </div>
              </div>
              <div class="text-right">
                <span class="px-3 py-1 rounded-full text-xs font-medium {{ v.badge_color }}">{{ v.release_type }}</span>
              </div>
            </div>

            <p class="mt-4 text-gray-300">{{ v.changelog }}</p>

            <div class="mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <div class="text-sm text-gray-400">Size: <span class="text-gray-200">{{ v.filesize }}</span></div>

              <div class="flex items-center gap-3">
                {% if v.download_url or v.arch_urls.x64 %}
                  <a href="{{ v.download_url|default:v.arch_urls.x64 }}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-primary to-secondary rounded-md font-semibold">
                    <i class="fa-solid fa-download mr-2"></i> Download
                  </a>
                {% endif %}
                {% if v.arch_urls.x86 %}
                  <a href="{{ v.arch_urls.x86 }}" class="inline-flex items-center px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md font-semibold">
                    <i class="fa-solid fa-download mr-2"></i> Download x86
                  </a>
                {% endif %}
                {% if v.checksum %}
                  <button data-checksum="{{ v.checksum }}" class="copy-checksum px-3 py-2 bg-transparent border border-gray-700 rounded-md text-sm">Copy checksum</button>
                {% endif %}
              </div>
            </div>

            {% if v.checksum %}
              <div class="mt-4 text-xs text-gray-400">Checksum: <code class="block break-all bg-gray-900 p-2 rounded-md mt-1">{{ v.checksum }}</code></div>
            {% endif %}
          </div>
        {% else %}
          <div class="bg-dark-800 border border-gray-800 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold">v{{ v.version }} <span class="text-sm text-gray-400">· {{ v.release_type }}</span></div>
                <div class="text-sm text-gray-500">{{ v.published_at|date:'M j, Y' }} — {{ v.filesize }}</div>
              </div>
              <div class="flex items-center gap-2">
                {% if v.download_url or v.arch_urls.x64 %}
                  <a href="{{ v.download_url|default:v.arch_urls.x64 }}" class="px-3 py-2 bg-gradient-to-r from-primary to-secondary rounded-md text-sm">Download</a>
                {% endif %}
                {% if v.arch_urls.x86 %}
                  <a href="{{ v.arch_urls.x86 }}" class="px-3 py-2 bg-gray-700 rounded-md text-sm">x86</a>
                {% endif %}
                {% if v.checksum %}
                  <button data-checksum="{{ v.checksum }}" class="copy-checksum px-3 py-2 bg-transparent border border-gray-700 rounded-md text-sm">Copy</button>
                {% endif %}
              </div>
            </div>
            <div class="mt-3 text-sm text-gray-300">{{ v.changelog }}</div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <aside class="space-y-4">
      <div class="bg-dark-800 border border-gray-800 rounded-lg p-4">
        <h4 class="font-semibold">Release checklist</h4>
        <ul class="mt-3 text-sm text-gray-300 space-y-2">
          <li>Signed installer</li>
          <li>SHA-256 checksum</li>
          <li>Verified on CI</li>
        </ul>
      </div>

      <div class="bg-dark-800 border border-gray-800 rounded-lg p-4">
        <h4 class="font-semibold">Need help?</h4>
        <p class="text-sm text-gray-300 mt-2">Visit our <a href="/contact" class="text-primary underline">contact page</a> or join the Discord for support.</p>
      </div>
    </aside>
  </div>

  <div class="mt-10 max-w-3xl mx-auto" id="faq">
    <h3 class="text-2xl font-semibold mb-4">FAQ</h3>
    <div class="space-y-3">
      <details class="bg-dark-800 border border-gray-800 rounded-md p-4">
        <summary class="font-medium">Is this installer safe?</summary>
        <div class="mt-2 text-sm text-gray-300">Yes — the installer is signed and distributed directly from our servers. Use the provided SHA-256 checksum to verify integrity.</div>
      </details>

      <details class="bg-dark-800 border border-gray-800 rounded-md p-4">
        <summary class="font-medium">Do I need an account?</summary>
        <div class="mt-2 text-sm text-gray-300">You can use the app without an account, but sync and purchases require authentication.</div>
      </details>

      <details class="bg-dark-800 border border-gray-800 rounded-md p-4">
        <summary class="font-medium">How do I report bugs?</summary>
        <div class="mt-2 text-sm text-gray-300">Open an issue on our GitHub or contact support via the contact page.</div>
      </details>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  // copy checksum buttons
  document.addEventListener('click', function(e){
    const btn = e.target.closest('.copy-checksum');
    if(!btn) return;
    const checksum = btn.getAttribute('data-checksum');
    if(!checksum) return;
    navigator.clipboard?.writeText(checksum).then(()=>{
      const original = btn.innerHTML;
      btn.innerHTML = 'Copied!';
      setTimeout(()=>btn.innerHTML = original, 1500);
    }).catch(()=>{
      alert('Copy failed — select and copy manually.');
    });
  });

  if(location.hash){
    const el = document.querySelector(location.hash);
    if(el) setTimeout(()=>el.scrollIntoView({behavior:'smooth', block:'center'}), 200);
  }
</script>
{% endblock %}
